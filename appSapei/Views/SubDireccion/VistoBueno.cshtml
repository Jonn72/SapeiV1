<input type="hidden" id="hidID" value="" />

<div class="page-title">
    <div class="title_left">
        <h3>Visto Bueno <small>de personal</small></h3>
    </div>
</div>
<div class="clearfix"></div>

@Html.Partial("../Generales/TablaGeneral")
@if (ViewData["Jefes"].ToString() == "1") {
@Html.Partial("../Generales/ModalVisorSchedule")
}
@Html.Partial("../Generales/ModalVisorPDF")
@Html.Partial("../Generales/FirmaElectronica")
@Html.Partial("../Generales/ModalAlertaConfirmacion")

<div id="Carga"></div>


<script type="text/javascript">


                orden(@if (ViewData["Jefes"].ToString() == "1") { @Html.Raw("3")} else {@Html.Raw("4") }, "desc");


                        ocultar_buscar();

                        function displaySection(ID, status) {
        $('#divModalVisorPDF').modal('show');
        $("#divCargando").hide();
        $("#divPDF").show();
        $('#divModalFirmaElectronica').modal('hide');
                            if (status === "A") {
            $("#btnFirmarHorarioPersonal" + ID + "").show();
            $("#btnCancelar" + ID + "").show();
                            }
                        }

                        function displaySection2(rfc, periodo) {
        $('#divModalVisorSchedule').modal('show');
                            $("#divCargandoSchedule").hide();
        $("#divSchedule").show();
        $("#btnFirmarHorarioPersonal_" + rfc + "_" + periodo).show();
                        }

                        function displayAlert(ID) {
                            var html = "¿Esta segura(o) que desea cancelar esta solicitud?"
        $('#replace').html(html);
        $('#ModalAlertaConfirmacion').modal('show');
        $('#hidModalAlertaConfirmacion').val(ID);
                        }

                        function vistaHorario(ID, status) {

        $("#divCargando").show();
        $("#divPDF").hide();
        $('#divPDF').load('../../../../Reportes/HorarioRecontratacionPDF?psID=' + ID, displaySection(ID, status));
                        }

                        function vistaHorarioJefes(rfc, periodo) {

                            $("#divCargandoSchedule").show();
        $("#divSchedule").hide();
                            setTimeout(() => { $('#divSchedule').load('../../../../Generales/VisorHorariosJefes?psRFC=' + rfc + '&psPeriodo=' + periodo, displaySection2(rfc, periodo)); }, 1000);
                        }

                        function vistaHorarioFacilitador(ID, status) {

        $("#divCargando").show();
        $("#divPDF").hide();
        $('#divPDF').load('../../../../Reportes/HorarioRecontratacionFacilitadorPDF?psID=' + ID, displaySection(ID, status));
                        }

                        function PreparaFirma(ID) {
        $("#hidID").val(ID);
        $('#divModalFirmaElectronica').modal('show');
        $("#btnFirmarCargaAcademica").show();
                        }

    $("#btnEnviarFirmar").click(function () {
                            var firma = $("#txtFirma").val();
                            var ID = $("#hidID").val();
                            var Status = "4";
        $('#divModalFirmaElectronica').modal('hide');

        $.ajax({
                            asyn: false,
            url: '../../../Generales/FirmaHorarioPersonal',
            type: 'POST',
            dataType: 'json',
            data: { psFirma: firma, psID: ID, psStatus: Status },
        })
            .done(function (data) {

                                if (typeof (data.Success) === "undefined" || !data.Success) {
                                    MensajesToastr("error", "Solicitud Procesada", "Error al Guardar");
                                }
                                else {
                                    MensajesToastr("success", "Solicitud Procesada", "Registro Correcto");

                    $('#BodyPrincipal').load('../../../../SubDireccion/VistoBueno');
                    $('.modal-backdrop').remove();
                                }
                            })
            .fail(function (data) {
                                MensajesToastrErrorConexion();
                            }).always(function () {
                            });
        event.preventDefault();
    });

    $("#btnAlertaConfirmar").click(function () {
                    var ID = $('#hidModalAlertaConfirmacion').val();

        $.ajax({
                    url: '../../../Generales/CancelarSolicitud',
            type: 'POST',
            dataType: 'json',
            data: { psID: ID }
                    })
            .done(function (data) {
                        if (typeof (data.Success) !== "undefined" && !data.Success) {
                            MensajesToastr("warning", "Error de proceso", data.Mensaje);
                        }
                        else {

                            if (data.Mensaje === "delete") {
                                MensajesToastr("info", "Solicitud Procesada", "Horario Cancelado, reportelo al departamento correspondiente.");
                        $('#BodyPrincipal').load('../../../../SubDireccion/VistoBueno');
                        $('.modal-backdrop').remove();
                            }

                            else if (data.Mensaje === "NE") {
                                MensajesToastr("info", "Solicitud Procesada", "El registro no se ha podido eliminar");
                            }
                        }
                    })
            .fail(function (data) {
                        MensajesToastrErrorConexion();
                    });

                });


    function LiberarHorario(rfc, periodo) {

        $.ajax({
                    asyn: false,
            url: '../../../Generales/LiberaHorarioJefes',
            type: 'POST',
            dataType: 'json',
            data: { psRFC: rfc, psPeriodo: periodo },
        })
            .done(function (data) {

                        if (typeof (data.Success) === "undefined" || !data.Success) {
                            MensajesToastr("error", "Solicitud Procesada", data.Mensaje);
                        }
                        else {
                            MensajesToastr("success", "Solicitud Procesada", data.Mensaje);

                    $('#BodyPrincipal').load('../../../../SubDireccion/HorarioJefes');
                    $('.modal-backdrop').remove();
                        }
                    })
            .fail(function (data) {
                        MensajesToastrErrorConexion();
                    }).always(function () {
                    });
        event.preventDefault();
                }
</script>